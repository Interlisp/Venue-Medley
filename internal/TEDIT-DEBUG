(DEFINE-FILE-INFO PACKAGE "INTERLISP" READTABLE "INTERLISP" BASE 10)(FILECREATED "24-Oct-2024 09:09:14" {DSK}<Users>kaplan>Local>medley3.5>venue-medley>internal>TEDIT-DEBUG.;7 8956         changes to%:  (FNS TTEST GTS \TEDIT.PRIMARYPANE)                    (VARS TEDIT-DEBUGCOMS)      previous date%: "21-Oct-2024 23:10:41" {DSK}<Users>kaplan>Local>medley3.5>venue-medley>internal>TEDIT-DEBUG.;1)(PRETTYCOMPRINT TEDIT-DEBUGCOMS)(RPAQQ TEDIT-DEBUGCOMS ((FNS GTO GTS)                            (COMS (FNS TTEST INSP THC)                                  (INITVARS (LASTTTESTFILE))                                  (INITVARS (TTESTDIRECTORY (MEDLEYDIR                                                                    "..>working-medley>tedit-tests")))                                  (VARS * TTESTREGIONS))                            (FNS \TEDIT.PRIMARYPANE)))(DEFINEQ(GTO  [LAMBDA (ARG NOERROR)                                  (* ; "Edited  9-Aug-2024 13:14 by rmk")    (LET ((TSTREAM (GTS ARG NOERROR)))         (CL:WHEN TSTREAM             (fetch (TEXTSTREAM TEXTOBJ) of TSTREAM))])(GTS  [LAMBDA (ARG NOERROR)                                  (* ; "Edited 24-Oct-2024 09:01 by rmk")                                                             (* ; "Edited 21-Sep-2024 21:51 by rmk")                                                             (* ; "Edited 11-Aug-2024 21:53 by rmk")    (CL:UNLESS (AND (CAR (NLSETQ (TEXTSTREAM LASTTEXTSTREAM)))                    (OPENWP (\TEDIT.PRIMARYPANE LASTTEXTSTREAM)))           (SETQ LASTTEXTSTREAM NIL))    (LET [(TSTREAM (CAR (NLSETQ (TEXTSTREAM (OR ARG (WHICHW]         (if TSTREAM             then (if (EQ TSTREAM LASTTEXTSTREAM)                        elseif (NULL LASTTEXTSTREAM)                          then (SETQ LASTTEXTSTREAM TSTREAM)                        elseif (AND (NOT (OR (type? TEXTOBJ ARG)                                                 (STREAMP ARG)))                                        (EQ 'Y (ASKUSER NIL 'Y "  Switch default textstream? ")))                          then (SETQ LASTTEXTSTREAM TSTREAM))                   TSTREAM           elseif (AND (NULL ARG)                           LASTTEXTSTREAM)           elseif NOERROR             then NIL           else (TEXTSTREAM ARG]))(DEFINEQ(TTEST  [LAMBDA (FILE REGION OPENONLY AFTERFORMS DONTQUIT READONLY)                                                             (* ; "Edited 24-Oct-2024 09:09 by rmk")                                                             (* ; "Edited  5-May-2024 21:55 by rmk")                                                             (* ; "Edited 29-Nov-2023 10:50 by rmk")                                                             (* ; "Edited 23-Nov-2023 14:28 by rmk")                                                             (* ; "Edited 22-Oct-2023 00:07 by rmk")                                                             (* ; "Edited  9-Sep-2023 17:21 by rmk")                                                             (* ; "Edited  8-Sep-2023 00:16 by rmk")                                                             (* ; "Edited 19-Aug-2023 10:57 by rmk")                                                             (* ; "Edited 17-Jul-2023 18:01 by rmk")                                                             (* ; "Edited 15-Jul-2023 21:05 by rmk")    (* ;; "FILE NIL gets the last file.")    (* ;; "Region NIL defaults to last region, T always gets a new one.  If we are reusing the region, we also close the previous file and kill its process.")    (* ;; "OPENONLY creates the text stream, doesn't create the window or process")    [if (NULL REGION)        then [SETQ REGION (REGIONP (EVALV 'LASTTEXTSTREAMREGION]      elseif (AND (LITATOM REGION)                      (REGIONP (EVALV REGION)))        then (SETQ REGION (COPY (EVALV REGION]    (IF FILE        THEN [LET ((SUBDIR (LISTGET (UNPACKFILENAME.STRING FILE)                                      'SUBDIRECTORY))                       (TESTDIR TTESTDIRECTORY))                      (CL:WHEN SUBDIR                          (SETQ TESTDIR (CONCAT TESTDIR "/" SUBDIR))                          (SETQ FILE (ROOTFILENAME FILE)))                      (CL:UNLESS (STRINGP FILE)                          (SETQ FILE (OR (FINDFILE-WITH-EXTENSIONS FILE (CONS (DIRECTORYNAME T)                                                                              (CONS TESTDIR                                                                                     DIRECTORIES))                                                '(TEDIT TXT NIL))                                         (ERROR "FILE NOT FOUND" FILE))))]              (SETQ LASTTESTFILE FILE)      elseif (AND (BOUNDP 'LASTTESTFILE)                      LASTTESTFILE)        then (SETQ FILE (OR (STRINGP LASTTESTFILE)                                (PACKFILENAME 'VERSION NIL 'BODY LASTTESTFILE)))      else (ERROR "NO FILE SPECIFIED"))    (CL:WHEN (STRINGP FILE)        (SETQ FILE (OPENSTRINGSTREAM FILE)))    (LET (TEXTSTREAM TEXTOBJ)         (DECLARE (SPECVARS TEXTSTREAM TEXTOBJ))         (CL:WHEN (AND (BOUNDP 'LASTTESTSTREAM)                       (TEXTSTREAMP LASTTESTSTREAM))             (CL:UNLESS DONTQUIT                 (replace (TEXTOBJ \DIRTY) of (TEXTOBJ LASTTESTSTREAM) with NIL)                 (TEDIT.QUIT LASTTESTSTREAM)))         [SETQ TEXTSTREAM (if OPENONLY                              then [OPENTEXTSTREAM FILE NIL NIL NIL (CL:WHEN READONLY                                                                            '(READONLY T))]                            else [if (REGIONP REGION)                                         then (SETQ REGION (COPY REGION))                                       elseif REGION                                       else (AND NIL (SETQ REGION 'TTEST]                                  (TEXTSTREAM (TEDIT FILE (COPY REGION)                                                     NIL                                                     `(LEAVETTY T ,@(CL:WHEN READONLY                                                                        `(READONLY T))]         (SETQ LASTTESTSTREAM TEXTSTREAM)         (SETQ LASTTEXTSTREAMREGION (REGIONP REGION))         (SETQ TEXTOBJ (TEXTOBJ TEXTSTREAM))         (CL:WHEN AFTERFORMS             (if (NLISTP AFTERFORMS)                 then (APPLY* AFTERFORMS)               elseif (NLISTP (CAR (LISTP AFTERFORMS)))                 then (EVAL AFTERFORMS)               elseif (LISTP (CAR AFTERFORMS))                 then (EVAL (CONS (FUNCTION PROGN)                                      AFTERFORMS))))         (SETQ LASTTEXTSTREAM TEXTSTREAM)                    (* ; "for GTS")         TEXTSTREAM])(INSP
  [LAMBDA (DONTCLOSE TOBJ)                                   (* ; "Edited 31-Oct-2023 19:45 by rmk")
                                                             (* ; "Edited 20-Apr-2023 08:10 by rmk")
                                                             (* ; "Edited 19-Apr-2023 08:00 by rmk")
                                                             (* ; "Edited 13-Apr-2023 09:44 by rmk")
    (SETQ TOBJ (GTO TOBJ))
    (CL:UNLESS DONTCLOSE (CLOSEI))
    (SP TOBJ)
    (AND NIL (INSPECT (FETCH PCTB OF TOBJ)
                    'LIST))
    (INSPECT (FETCH SEL OF TOBJ])(THC
  [LAMBDA (TSTREAM PRINTER TYPE)                             (* ; "Edited 10-Jul-2023 23:00 by rmk")
    (CL:UNLESS TYPE (SETQ TYPE DEFAULTPRINTERTYPE))
    (LET ((TFILE (TXTFILE (GTO TSTREAM)))
          HCFILE)
         (CL:UNLESS PRINTER
             (SETQ HCFILE (OUTFILEP (PACKFILENAME 'EXTENSION TYPE 'VERSION NIL 'NAME
                                           (PACK* (FILENAMEFIELD TFILE 'NAME)
                                                  'W)
                                           'BODY TFILE))))
         (HARDCOPY.SOMEHOW (WFROMDS (TEXTSTREAM (GTO TSTREAM)))
                HCFILE TYPE)
         HCFILE]))(RPAQ? LASTTTESTFILE )(RPAQ? TTESTDIRECTORY (MEDLEYDIR "..>working-medley>tedit-tests"))(RPAQQ TTESTREGIONS (RBRAVO RHUGE RMID RSMALL RBIG RHIGH))(RPAQQ RBRAVO (1321 246 561 554))(RPAQQ RHUGE (865 26 811 957))(RPAQQ RMID (753 774 531 169))(RPAQQ RSMALL (858 796 462 81))(RPAQQ RBIG (900 400 600 358))(RPAQQ RHIGH (877 880 462 103))(DEFINEQ(\TEDIT.PRIMARYPANE  [LAMBDA (TSTREAM)    (CAR (fetch (TEXTOBJ \WINDOW) of (TEXTOBJ TSTREAM]))(DECLARE%: DONTCOPY  (FILEMAP (NIL (894 2426 (GTO 904 . 1150) (GTS 1152 . 2424)) (2427 8428 (TTEST 2437 . 7120) (INSP 7122 . 7772) (THC 7774 . 8426)) (8814 8933 (\TEDIT.PRIMARYPANE 8824 . 8931)))))STOP